<!-- title: [回顾]超快速打造属于自己的博客 -->
<!-- author: <David Jones qowera@qq.com> -->
<!-- date: 2016-03-19 18:19:13 -->
<!-- category: 项目回顾 -->
<!-- tag: nodejs,blog,develop -->

前几天用了 3天的时间将一个[博客](http://blog.davidkk.com)上线了，主要开发用了一天，设计用了一天，上线修BUG 又用一天.当然只是每日抽空出来做而已。功能超级简单

### Markdown

将 markdown 编译成文章，markdown 文件为另外一个 Git 库，与项目分离开来。

因为要文章具有 title, date, tags, archive 两项属性，因此必须将文章头部将这些信息暴露出来，因此我参考 hexo 的做法,而又进行了小许修改，直接在头部编写，具体如下：

```
<!-- title: [回顾]超快速打造属于自己的博客 -->
<!-- author: <David Jones qowera@qq.com> -->
<!-- date: 2016-03-19 18:19:13 -->
<!-- category: 项目回顾 -->
<!-- tag: nodejs,blog,develop -->
```

最后还要注意一点就是列表也需要文章摘要。当然，也可以通过标记获取，但这里我更喜欢自动化，因此使用了一个第三方库 `trim-html`，本人建议可以选择其他，因为这个库有段代码会压缩HTML将换行前的空格与换行(\s)删除掉，这样会导致代码块出现不换行。（浪费我很多时间查找 jade 配置是不是错了）

### 页面

主要需求的页面只有4个，主要包括 `归档页`, `文章页`, `列表页`, `分类页`。这里要注意的是`列表页`是需要分页的；而`文章页`是需要做评论与前后文章信息；评论下一小节再详细介绍；

这些功能都需要所有有文章信息。我们可以简单通过将编译文章将文章中的信息存储到数据库/缓存/文件中。其中怎么选择还是看个人。因为个人博客不算啥大型项目，因此我用最简单的做法，保存为JSON文件。

### 数据

上面说到需要文章的列表等数据做输出，我们可以简单使用一下项目构建工具 GruntJS 或者 Gulp 等纯碎看个人喜好，使用其主要是是将 markdown 的信息拆分出来并整合数据。并将数据存放到 `.runtime/db.json`。其中数据包括文章数据，当然这里只是个人简单做法。

当然，文章的编译成HTML也是最好使用 GruntJS 来编译，因为当 Nodejs 渲染视图的时候回出现两个模板引擎，Jade 与 markdown，这里容易造成混乱。因此我都是先将 markdown 文件预先编译成 HTML，直接嵌套到 Jade 的编译过程中的。

### 评论

这里最简单了，因为现在也有很多第三方评论可以使用。例如多说，有言，Disqus等。我这里用到的是 Disqus；我之前一个[团队博客](http://blog.ishgo.cn)中是使用多说的。

### 后端

我直接使用 Koa2，为什么使用第二版呢，主要是我抗拒不了 async await 的诱惑吧。而且很多插件都可以直接继承过来使用，同时也尝尝新事物。对 ES7 TS 等有兴趣的话也可以看看 `ThinkJS`， 个人感觉还是比较完善，不用一个一个中间件地安装。

### 路由

路由主要就由几个页面输出，例如 `index/list/1`, `index/list/tags/xxx/1`，除了普通页面的输出还要注意多层路由之间对功能的切换问题，这里不详细说，也可以更简单地做。

我这样做主要考虑的是前端还可以做成类SPA的形式。直接通过这样的路由来获取JSON,HTML等完成直接渲染，而非跳转。暂时预留功能以后有空再开发

### 钩子

为什么要使用钩子，最起码更新代码，要自动同步到生产环境并重启服务。重启服务可以使用 nodemon。但是最主要的是文章的钩子。其实也很简单：

首先我们可以将我们的文章放到 github 上的一个目录，例如 [https://github.com/DavidKk/david-dev-backup](https://github.com/DavidKk/david-dev-backup) 我的文章都放到这里。

我们可以通过 github 的 Webhook & services 来配置 webhook。我们可以简单建一个路由，然后给予相应的 Secret。当请求符合要求的时候通过进入路径并执行以下 `git pull` 就可以了

### 最后

当然不想编程还是可以直接使用 `WordPress`, `hexo` 等等其他途径打造博客。但是对于自己喜好有侧重的本人来说还是喜欢自己亲手打造一个超级简单的博客。

而最主要我还是觉得文章应该独立，当切换模板，博客换版，或者多博客共享文章的情况下可以使用一套文章文件。同时也能支持团队博客与个人博客同步。


### 最后的最后

暂时未能完成开源，因为很多东西都写死了，日后有时间可以将其修改修改并开源一份出来。最后写给未来回顾这屌博客的自己。


### 还没结束，简单贴一下 NPM 清单

```
"node-sass-import-once"     : "1.2.0",
"xmlbuilder"                : "^2.6.5",
"marked"                    : "^0.3.5",
"highlight.js"              : "^9.2.0",
"trim-html"                 : "^0.1.7",

"grunt"                     : "^0.4.5",
"grunt-contrib-copy"        : "^1.0.0",
"grunt-sass"                : "^1.1.0",
"grunt-contrib-clean"       : "^0.6.0",
"grunt-contrib-watch"       : "^0.6.1",
"grunt-concurrent"          : "^2.1.0",
"grunt-nodemon"             : "^0.4.1",

"babel-polyfill"            : "^6.7.2",
"babel-preset-es2015"       : "^6.5.0",
"babel-preset-react"        : "^6.5.0",
"babel-preset-stage-0"      : "^6.5.0",

"lodash"                    : "^4.5.1",
"jade"                      : "^1.11.0",

"co"                        : "^4.6.0",
"koa"                       : "^2.0.0-alpha.3",
"koa-router"                : "^7.0.1",
"koa-convert"               : "^1.2.0",
"koa-logger"                : "^1.3.0",
"koa-views"                 : "^4.1.0",
"koa-logger"                : "^1.3.0",
"koa-static"                : "^2.0.0",
"koa-static-cache"          : "^3.1.5",
"koa-mount"                 : "^2.0.0",
"koa-rewrite"               : "^1.1.1"
```