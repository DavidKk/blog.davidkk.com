<!-- title: [backup] 微信应用号初体验 -->
<!-- author: <David Jones qowera@qq.com> -->
<!-- date: 2016-10-07 19:43:39 -->
<!-- category: 微信 -->
<!-- tag: 微信 -->

# 微信应用号

首先附上[官方文档地址](https://mp.weixin.qq.com/debug/wxadoc/dev/index.html)

## 小程序定义

##### 相对于开发者来说

- 它是一个混合程序, 所以即不是纯粹的 `Native App` , 也不是纯粹的 `Web 应用`.
- 它是一个 **封闭**  的开发套件和框架, 而不是 **自由** 的 JavaScript + CSS + HTML. 因此, 你不能任性地使用 jQuery, zepto, 更不能使用基于 jQuery 的第三方控件 , 也由不得开发者决定要用 Angular 还是 React.
- 它很像 Apple 开发者的范式, 有开发者账号, 有 IDE , 有构建工具, 有 UI 规范等等.
- `MVC`架构, 开发者不可直接操作 DOM 节点, 页面根据数据的变化渲染 UI , 业务逻辑专注于数据操作.


## 生命周期

![生命周期](http://ww4.sinaimg.cn/large/736e4738gw1f8jms140ryj20hs098ta9.jpg)

## IDE开发工具(神奇的IDE)

#### 初始化请求接口错误

Failed to load resource: net::ERR_NAME_NOT_RESOLVED
http://1709827360.appservice.open.weixin.qq.com/appservice

![Proxy 错误](http://ww4.sinaimg.cn/large/736e4738gw1f8jmagxhtcj21kw0yhgq2.jpg)

大多数是 proxy 导致, 若果开启了 shadowscoks 请先关闭 然后再开启

#### 初始化对象问题错误

`TypeError: Cannot read property ‘MaxRequestConcurrent’ of undefined` 问题

![MaxRequestConcurrent 错误](http://ww4.sinaimg.cn/large/736e4738gw1f8jmc6d136j21d611wq5n.jpg)

可以按[破解的方法](https://github.com/gavinkwoe/weapp-ide-crack)替换 `/Resources/app.nw/app/dist/weapp/appservice/asdebug.js`

#### 假死情况

如果项目中存在过多的文件, 会经常出现假死情况

`node_modules` 过多的包(68,856个文件 -_-!!!, 一般情况下不需要安装其他的包, 只是个测试) 也可能出现 3-10 秒的假死情况

![假死情况](http://ww4.sinaimg.cn/large/736e4738gw1f8jmh7kexmj21kw0yhdgh.jpg)


## IDE 编译流程

待续...


## 特点

- 微信应用号的框架支持 babel 写法 (支持程度并不知道)
- 自带支持下最流行的 *VM 模式
- 自带一套好的本地存储, 体验比 Web 要好 (微信占用更大...)


## Getting Started

### 配置与文件

`/app.json` 是项目的主要配置

```JSON
// 官方DEMO
{
  "pages": [
    "pages/index/index",
    "pages/logs/index"
  ],
  "window": {
    "navigationBarTitleText": "Demo"
  },
  "tabBar": {
    "list": [{
      "pagePath": "pages/index/index",
      "text": "首页"
    }, {
      "pagePath": "pages/logs/logs",
      "text": "日志"
    }]
  },
  "networkTimeout": {
    "request": 10000,
    "downloadFile": 10000
  },
  "debug": true
}
```

- `pages` 属性包含所有的页面信息, 而第一个页面就是默认入口而 `windows` , `tabBar`等是配置头部等的配置具体参考文档
- app.wxxs 这是App的公共样式, 就是CSS, 而不是 `SASS`, `LESS`
- app.js 这是App的启动脚本, 这里可以处理一些App启动过程中页面加载之前要处理的事情
- 页面一个App可包含多个页面, 页面的相对访问路径被配置在app.json里, 每个页面可以包含 xxx.js, xxx.wxml, xxx.wxxs, 以及配置文件 xxx.json. 其中 wxxs 和 json 文件不是必需要的, 如果有, 那么它们会覆盖 app.json 和 app.wxxs 的相同配置项

#### 开始编写一个最简单的demo

```
// path/to/app.js
App({
  onLaunch () {
    console.log('Launch:', 'My first wechat app.');
  },
});

// path/to/app.json
{
  "pages":[
    "pages/index/index"
  ]
}

// path/to/pages/index.js
Page({
  onLoad () {
    console.log('Page Index:', 'My first wechat page is generated.');
  },
});

// path/to/pages/index.wxml
<view class="container">
  <text>Hello World</text>
</view>
```

![DEMO结果](http://ww3.sinaimg.cn/large/736e4738gw1f8jnoy338cj21kw0zkgrq.jpg)


## 微信应用号适用

![行业区分](http://ww2.sinaimg.cn/large/736e4738gw1f8jxilkcsdj20i50ad401.jpg)

![微信应用号适合什么](http://ww3.sinaimg.cn/large/736e4738gw1f8jxjgljqjj20i60aa0ti.jpg)


## 个人感觉

#### 产品层面

- 微信提供了不错的底层 API 以及还算丰富的组件库, 让小程序可以快速开发并且拥有原生体验, 相对之前的公众号/服务号, 体验更好
- 微信流量很大, 对于部分中小产品来说, 是一次机会
- 一些低频高需产品也许很适合, 比如订票, 用户打开页面, 简单选择, 然后微信支付, 感觉还挺爽的


#### 技术层面

- 微信应用号是基于微信生态的，而这个生态目前太不成熟. 微信应用号就好比死得很惨的 Chrome App, 但是相比下 Chrome App 更加开放, 而微信应用号更加封闭, 就连最基本的框架也必须用官方的而非单一开放各种接口 (最大的弊端)
- 只能在微信中运行，多半不支持在浏览器或者其他地方运行，也就是说，并没有减少产品的开发成本，反倒是多了一个开发流水线
- 目前开发调试工具/环境也不友好, 没有好的兼容反馈, 自己没去试根本不知道是否兼容 (各种崩溃/报错, 而且微信的 webkit 版本一直保持低版本, 不是很利于技术的革新)


## 目前已知细节


##### 选择器兼容

`wxss` 并不支持 `*` 选择器, 同时也没有 html > body 这些 DOM, 如果要写 `reset.css/normalize.css` 的时候要注意, 可以将选择器设置成 page 因为微信应用号中的 ROOT DOM 就是 `<page></page>`

![选择器错误](http://ww1.sinaimg.cn/large/736e4738gw1f8jorcc45uj21kw0zk45w.jpg)

##### 行内元素规范

```
<image src="..." />
<!-- 必须使用 `/>` 未做结束符号, 否则编译会报错 -->
```

![错误](http://ww4.sinaimg.cn/large/736e4738gw1f8jyva9k9tj21kw0yhgnz.jpg)

## 项目整合问题

待续...
