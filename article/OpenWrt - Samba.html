<!DOCTYPE html><html><head><base href="/"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="apple-mobile-web-app-title" content=""><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="description" content="David Jones Blog"><meta name="keywords" content="blog,codding,font-end,web,developer,javascript"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="styles/bootstrap.css"><title>Welcome | David Jones</title></head><body><header class="header-container"><div class="container"><a class="brand" href="/" title="blog.davidkk.com">dBLog</a><nav class="nav"><a href="/tag/index.html" title="tags">Tags</a><a href="/archive/index.html" title="archive">Archives</a></nav></div></header><div class="article-container container context"><main class="content"><article class="article"><h1 class="article-title">OpenWrt - Samba</h1><div class="article-infobar"><div class="category"><i class="fa fa-sticky-note-o"></i><a href="/category/OpenWrt/1.html" title="OpenWrt">OpenWrt</a></div><time class="date"><i class="fa fa-calendar-o"></i><span>4/11/2015, 12:57:14</span></time><div class="author">Written by:&nbsp;<a title="&lt;David Jones qowera@qq.com&gt;" target="_blank">&lt;David Jones qowera@qq.com&gt;</a></div></div><section class="article-content"><h3 id="-samba-luci-app-samba-webui-">安装 samba若安装 <code>luci-app-samba</code> 以下一系列操作都可以通过 WebUI 进行配置。<code>`</code></h3>
<p>$ opkg update
$ opkg install samba36-server     # 一般已经安装
$ opkg install luci-app-samba     # WebUI
<code>#### 配置共享文档</code></p>
<h1 id="-">创建需要共享的文档</h1>
<p>$ mkdir /share
$ chmod a+w /share
$ chown nobody:nobody /share# 修改配置模板，一般不用修改
$ vi /etc/samba/smb.conf.template[global]
  netbios name = |NAME|
  display charset = |CHARSET|
  interfaces = |INTERFACES|                   # 内网IP
  server string = |DESCRIPTION|
  unix charset = |CHARSET|
  workgroup = |WORKGROUP|
  browseable = yes
  deadtime = 30
  domain master = yes
  encrypt passwords = true
  enable core files = no
  guest account = nobody                      # 匿名用户
  guest ok = yes                              # 匿名用户</p>
<h1 id="invalid-users-root-">invalid users = root                      # 屏蔽</h1>
<p>  local master = yes
  load printers = no
  map to guest = Bad User
  max protocol = SMB2
  min receivefile size = 16384
  null passwords = yes                        # 无需密码
  obey pam restrictions = yes
  os level = 20
  passdb backend = smbpasswd
  preferred master = yes
  printable = no
  security = user
  smb encrypt = disabled
  smb passwd file = /etc/samba/smbpasswd
  socket options = TCP_NODELAY IPTOS_LOWDELAY
  syslog = 2
  use sendfile = yes
  writeable = yes                             # 可写# 修改配置
$ vi /etc/config/sambaconfig samba
        option name           &#39;OpenWrt&#39;
        option workgroup      &#39;WORKGROUP&#39;
        option description    &#39;OpenWrt&#39;
        option homes          &#39;0&#39;config sambashare
        option name           &#39;share&#39;       # 网络显示的共享目录名字
        option read_only      &#39;no&#39;          # 只读
        option users          &#39;share&#39;       # share 用户需要自行创建，下面会介绍
        option create_mask    &#39;0777&#39;        # 读写权限
        option dir_mask       &#39;0777&#39;        # 读写权限
        option path           &#39;/share&#39;      # 共享目录，记得设置目录为可写
        option guest_ok       &#39;no&#39;          # 匿名用户# 重启
$ /etc/init.d/samba restart
$ /etc/init.d/samba enable# 设置密码
$ smbpasswd root
New SMB password:
Retype SMB password:
<code>现在你可以在网上邻居找到该设备### 新建用户我们想在 Samba 添加一个用户，我们首先要创建一个系统用户；
又因为 OpenWrt 没有 `useradd` 我们可以安装 `shadow-groupadd`, `shadow-useradd`</code>
$ opkg update
$ opkg install shadow-groupadd shadow-useradd# 现在我们可以使用 <code>useradd</code> 命令了# 创建用户
$ useradd share</p>
<pre><code class="hljs ruby">$ vi /etc/passwd<span class="hljs-comment"># 添加一行</span>
<span class="hljs-symbol">share:</span>*<span class="hljs-symbol">:</span><span class="hljs-number">501</span><span class="hljs-symbol">:</span><span class="hljs-number">501</span><span class="hljs-symbol">:share</span><span class="hljs-symbol">:/home/share</span><span class="hljs-symbol">:/bin/false</span><span class="hljs-comment"># 修改密码，密码可以不添加</span>
$ passwd share
<span class="hljs-symbol">passwd:</span> no record of share <span class="hljs-keyword">in</span> /etc/shadow, using /etc/passwd
Changing password <span class="hljs-keyword">for</span> share
New <span class="hljs-symbol">password:</span>
Bad <span class="hljs-symbol">password:</span> too weak
Retype <span class="hljs-symbol">password:</span>
Password <span class="hljs-keyword">for</span> share changed by root<span class="hljs-comment"># 添加组</span>
$ vi /etc/group<span class="hljs-comment"># 添加一行</span>
<span class="hljs-symbol">share:</span><span class="hljs-symbol">x:</span><span class="hljs-number">501</span><span class="hljs-symbol">:</span><span class="hljs-comment"># 创建用户文件夹</span>
$ mkdir /usr/share
$ chown -R <span class="hljs-symbol">share:</span>share /usr/share
<span class="hljs-string">``</span><span class="hljs-string">`现在我们可以添加一个 SMB 用户了</span></code></pre><h1 id="-smb-">添加 SMB 用户，这里的密码是共享文件访问密码而非该用户的密码</h1>
<p>$ smbpasswd -a share
New SMB password:
Retype SMB password:# 然后重启一下
$ /etc/init.d/samba restart
<code>`</code>参考文章- <a href="http://vladimir-ivanov.net/create-user-without-useradd-command-OpenWrt/">How to create user without useradd command in OpenWrt</a>### 其他 samba 功能，详细请看- <a href="https://www.samba.org/samba/docs/">samba 官方docs</a></p>
</section><div class="article-widgets"><div class="tags"><i class="fa fa-tags"></i><a href="/tag/OpenWrt/1.html" title="OpenWrt">OpenWrt</a><a href="/tag/路由器/1.html" title="路由器">路由器</a></div></div></article><nav class="pagination"><ul class="pagination-simple"><li><a href="/article/OpenWrt - IPv4 to IPv6.html" title="OpenWrt - IPv4 to IPv6"><span>Previous</span><span>OpenWrt - IPv4 to IPv6</span></a></li><li><a href="/article/OpenWrt - Shadowsocks + ChinaDNS + redsocks.html" title="OpenWrt - Shadowsocks + ChinaDNS + redsocks"><span>Next</span><span>OpenWrt - Shadowsocks + ChinaDNS + redsocks</span></a></li></ul></nav><div class="comments"><div class="disqus-plugin"><div id="disqus_thread"></div><script>!(function() {
  var d = document;
  s = d.createElement('script');
  s.src = '//davidkk.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  !(d.head || d.body).appendChild(s);
})();</script></div></div></main></div><footer class="footer-container"><div class="container"><div class="about"><a class="link" href="https://github.com/DavidKk" title="Github" target="_blank"><i class="fa fa-github-alt"></i></a><a class="link" href="http://codepen.io/DavidJones" title="CodePen" target="_blank"><i class="fa fa-codepen"></i></a><a class="link" href="https://twitter.com/Mr_DavidJones" title="Twitter" target="_blank"><i class="fa fa-twitter"></i></a><span><i class="fa fa-heart"></i></span><a class="link" href="https://plus.google.com/u/0/111899862347999076942" title="Google Plus" target="_blank"><i class="fa fa-google-plus"></i></a><a class="link" href="http://weibo.com/307853201" title="微博" target="_blank"><i class="fa fa-weibo"></i></a><a class="link" href="mailto:qowera@qq.com" title="E-Mail"><i class="fa fa-envelope-o"></i></a></div><p class="copyright clearfix">Powered by&nbsp;<a href="/">davidkk.com</a>&nbsp;&copy; 2016
,&nbsp;<a href="/static/sitemap.xml" title="Sitemap">Sitemap</a></p></div></footer><script src="scripts/index.js"></script><script id="dsq-count-scr" src="//davidkk.disqus.com/count.js" async></script></body></html>